# Telegram бот для автостёкол

### Кратко о том, как это работает:
* Telegram bot - самостоятельная единица. Представлен в проекте файлом ```tlg_bot.py```
* Django проект - вообще Django - это веб-фреймворк, на нём бэкэнд пишут. Вот и здесь на нём написан бэкэнд.
* Бот отдаёт единственную кнопку, по которой открывается веб-страница в окне самого приложения телеграм. Вот как раз для этой веб-страницы и нужен бэкэнд.
* На страничке несколько форм, на бэкэнде несколько вьюшек для обработки POST запросов по этим формам.
* Данные о новых заявках сохраняются в БД. БД тут самая примитивная sqlite, по желанию можно докрутить PostgreSQL, MySQL - что душе угодно.
* Также инфа о новых заявках отсылается сообщением ряду пользователей Telegram, или одному - в общем, тут тоже всё настраиваемо
* А настроить всё это можно в админке. Админка доступна по адресу: ```<domain_name>/admin```
* Также в админке можно посмотреть все заявки и сопутствующую им инфу.

### Как это развернуть:
1. Нужно создать файл ```.env``` (в проекте для примера лежит файл ```env```) и внести в него значения:
   * BOT_TOKEN - токен бота
   * FORM_ADS - URL адрес, по которому будет доступна форма
2. Проверить версию python на хосте (должна быть не ниже 3.8). Сделать на Ubuntu это можно так:
   ```
   user@user:~$ python3 --version
   Python 3.10.6
   ```
3. Перейти в директорию с проектом и установить зависимости:
   ```python3 -m pip install -r requirements.txt```
4. Выполнить миграции 
   ```python3 manage.py migrate```
5. Собрать всю статику в одну директорию, выполнив команду
   ```python3 manage.py collectstatic```
6. Создать суперпользователя для админки. Попросят ввести данные, email не обязательно. Если пароль слабый, то будет предупреждение, это можно будет подтвердить и, в принципе, всё.
   ```python3 manage.py createsuperuser```
7. Установить и настроить Gunicorn (см. файл "Gunicorn_установка_и_настройка")
8. Настроить Nginx для работы c Gunicorn (см. файл "NGINX_уст_и_настройка")
9. Веб-страница с формами должна быть доступна по https, иначе приложение телеграм не будет открывать её из бота.
10. Если будут проблемы, то я на связи в телеграм https://t.me/DanyaSevas

### Настройки проекта
1. В админ панели, в разделе ```Настройки``` внести следующие значения:
    * ключ ```bot_token``` - токен бота
    * ключ ```tlg_admin_id``` - ID админа бота - получателя уведомлений в Telegram(их можно вносить несколько с таким ключом)
    * ключ ```green_api_instance_id``` - IdInstance из ЛК GreenAPI
    * ключ ```green_api_token``` - ApiTokenInstance из ЛК GreenAPI
    * ключ ```whatsapp_notification_phone``` - Телефон ватсап, на который будут отправляться уведомления о новых заявках(международный формат без +, пример для РФ: ```79007775544```)
